# Иерархическая структура UNIX BSD 4.4

Нижний уровень (аппаратура)
- Диспетчеризация процессов
- Сетевое пространство
- Драйверы:
- - символьные устройства
- - блочные устройства
- - сетевые устройства

2 уровень
- Планирование процессов
- Маршрутизация
- Страничный кэш
- Буферный кэш

... (фото)

Диспетчеризация - выделение процессам проц времени.

Планирование - определение в какой посл будут вып процессы.

Микроядро - в нем оставлены только самые низкоур функции для взаим с аппарат частью. Остальные части реализуются в виде отдельных процессов.

Последовательность действ вып системой при запросе приложения на ввод и вывод: (книга Шоу)


| Приложение | Ядро | | |
| - | - | - | - |
| Запрос ввода-вывода | --v (системный вызов read/write) | | |
| | (SVC - supervisor call) | --v | |
| | | Драйвер внеш устройства | --v (начало ввода-вывода) |
| | | v-- | завершение вв-выв прерывание от внеш устройства |
| | | IO IH (Interrupt handler) | |
| ... |

(Схема: блокирующий синхронный ввод-вывод)

Супервизор - ОС в стадии выполнения

Обработчики прер явл неотъем частью драйверов. (точка входа)

---
## Микроядерная архитектура.

Загружаемые модули ядра - возможно изменить микроядро без перекомпиляции. (но не любые изменения)

Программы оп системы принято называть серверами ОС.

Модель клиент-сервер.

Любая кс арх предполагает протокол, по которому она работает.

в состав серверов входит сервер памяти, сетевой сервер, сервер безопасности, файловый сервер, сервер процессов.

(фото)

---
## Эффективность микроядерной архитектуры

В монолитном ядре при обаботке сис вызова будет вып 2 перекл, 1 из задачи в реж ядра, 2 - обратно из ядра в реж задачи.

привлекательность мя арх - большая часть кода ядра вынесена в режим пользователя - большая возможность адаптации под конкретные задачи.

Для комерческих реализаций микроядро Mach перестаёт быть микро. В частности файловая подсистема, поддержка сетей и управление памятью выполняется в режиме ядра. Причина проста - системы построенные строго по принципу микроядра слишком низкоэффективны и не подходят для комерческих целей.

Пример: QNX построена на основе микроядерной арх.

POSIX 1003.1 - определение реального времени:

Реальное время в ОС - это способность ОС обеспечить требуемый уровень сервиса за определенный промежуток времени.

Задачи реального времени составляют одну из сложнейших областей применения вычислительной техники.

Оп система Mach

Как и любая ОС определяет основные абстракции, на кот баз ее работа:

1. Процессы
2. Потоки
3. Объекты памяти
4. Порты
5. Сообщения

Отлич особ ОС Mach - понятие объект памяти. Этот объект предст собой структуру данынх, которая может быть отображения в адр простр процесса. Обхъекты памяти могут занимать одну или неск страниц и явл основой для систем управления вирт памятью. Когда процесс обращяется к объекту памяти который отсутств в физ памяти, то возникает страничное прерывание. Ядро обраб это прер, но в отл от др систем, ядро Mach для загрузки отстутств страницы посылает сообщение серверу режима пользователя. Только после того как этот запрос будет обработан, ядру будет получен ответ от серв памяти, соотв страница сможет быть загр в физ мапять. Все основано на передаче сообщений. Для того чтобы передавать соообщения процесс пользователя просит ядро создать защищ почтовый ящик, который в Mach называется порт. Порт создается в адресном простр ядра и способен поддерж очередь сообщений. Как правило очередь имеет опр размер и если процесс пытается послать сообщение, а кол-во сообщ уже равно максимальному, то такой процесс будет блокирован, до того момента, когда порт не будет разгружен от этих сообщений.

В Мач поддерж разные типы портов (не простое это дело, такое взаимодействие):

- порт процесса (использ процессом для взаимодействия с ядром. В этот порт он посылает сообщ для обслуживания)
- порт загрузки (этот порт использ при старте системы. Самый первый проц читает из этого порта имена портов ядра которые обеспечивают самые важные сервисы системы)
- порт особых ситуаций (используется системой для передачи сообщ об ошибках процессу)
- зарегистрированные порты (используются для обесп взаимодейств процессов со станд сист серверами)
