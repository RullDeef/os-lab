# Реализация управления памятью в процессорах Intel

В 64-х разрядных компьютерах аппаратно сегментация не поддерживается.

Сегментация в защ режиме  это крайне запут тема. Она была реализ-на в самых перыв процах поддерж вирт память.

Даже в пентиум она сущет но от нее уходят переходя на страничное преообрахование.

---

Литература:

- Медник и Донован, "IBM-360" (схема отсюда)

---

(схема)

Адресное пространство диска делится на две неравные части. Одна часть - область своппинга (пейджинга) размер этой области пользователь определял вручную (в старых верс линуха). Совр системы этого не требуют. Тем не менее можно поменять размер жтой области. Вся ост часть отведена файловой подсистеме (для хранения обычных файлов - которые создаются различными приложениями).

Кроме обычных файлах в системе имеются другие файлы. в частности софтлинки, пайпы, сокеты, устройства оп системы.

Если в системе выделяется спец область для пейджинга, то возникает след ситуация. Сама программа (исп файл) занимает какое-то адр простр диска. когда прог запуск на выполнение то она копируется в область пейджинга и уже из этой области она начинается копирование строниц в физ память в результате программа сущ в системе как минимум в 3 копиях, по этому в совр системах для того что бы боолее эфф иссп адр простр диска исп-ся так назыв-я одноуровневая память (книга: "AS400").

Одноур предп что пейджинг происх в адр прос-во файла. В это адр про-во можно выполнять пейджинг, но для этого надо иметь спец таблицу (одно дело адресация файла, другое - реализация отображения страниц этого файла).

В защищенном режиме сущ 2 типа страничного преобразования - стандартное и PAE

При стд страничном проебразовании 32 рр вирт адрес делится на 3 части: эта схема кореллирует с гипер страницами.

4Кб страницы - не единст размер поддерж. проц интел. (есть схемы с 1МБ, 2МБ страницы - для баз данных)

если стр. 4Кб - 12 разрядов для смещения

(схема 2)

---

2 Типичные структуры виртуального адресного пространства 32х разрядной операционной системы Windows.

(схема 3)

В Юник сист всегда выделяется в 32рр системах 1ГБ.

---

Следующее страничное преобразование.

32рр вирт адрес делится на 4 поля.

!! Каждое такое деление связано с доп обращением к оп памяти при преобр адреса.

Выигрыш - возможность хранить в системной области памяти только актуальные таблицы страниц.

---

Рассмотрим 32 битный дескриптор таблицы страниц PTE для 4Кб страницы.

Первые 12 разрядов смещения используются в виде флагов, а оставшиеся разряды - это начальный адрес страницы (Page Base Address).

биты:

- 0 - P - Present
- 1 - R/W - read/write
- 2 - user/superuser
- 3 - Page write through
- 4 - Page cache disable
- 5 - Reserved
- 6 - Dirty
- 7 - Page table attribute
- 8 - global page
- 9-11 - AVL

---

В проц интел выполняется кеширование. Кеш называется TLB. (4-направленный ассоциативный по множеству кеш)

(схема 5)

Замещение кеша TBL реализовано по псевдо алг LRU. Для этого имеется блок достоверности LRU. Каждая строка имеет бит достоверности.

При очистке кеша или сбросе проца все биты дост сбрасываются в ноль.
Когда производится заполнение строки кеша ищется любая недостоверная строка.
Если недостоверных строк нет, то замещаемую строку выбирают по псевдоалгоритму LRU.
(Для этого выделено 3 бита)

Эти биты модиф. при каждом попадании (страничная удача) или заполнении следующим образом:

1. Если обращ было в множестве к строке L0 или L1, то бит B0 устанавл в единицу.
Если обр было к L2 или 3 то B0 сбрасывается в 0;
2. Если обр к паре L0, L1 было к L0, то B1 = 1, если к L1, то B1 = 0;
3. Если обр к паре L2, L3 было к L2, то B2 = 1, если к L3, то B2 = 0.

| B0 | B1 | B2 | |
| - | - | - | - |
| 0 | 0 | x | L0 |
| 0 | 1 | x | L1 |
| 1 | x | 0 | L2 |
| 1 | x | 1 | L3 |

Утверждается, что в типичных системах кеш TLB удовлетворяет до 99% запросов на доступ к таблицам страниц. При этом буфер очищается при загрузке регистра CR3.
