Логические часы Лампорта.

Используется в модели непротиворечивости данных. Это общее название связанное с использованием синхронизации по часам.

Речь идет о репликациях.

Очевидно что репликация данных позволяет повысить надежность системы но требует поддерживания в актуальном состоянии нескольких копий данных. При этом рассматривается строгая непротиворечивость, последовательная непротиворечивость, причинная непротиворечивость и непротиворечивость FIFO.

Рассмотрим следующий пример.

Для повышения производительности по выполнению запросов банк может разместить копию базы данных по счетам в нескольких местах (причем в разных городах). При этом запросы посылаются к ближайшей копии. Очевидно, что платой за обеспечение быстрых ответов будет необходимость репликации. То есть обновления после каждой операции всех копий базы данных.
Для того чтобы не происходила потеря информации, чтобы эти репликации проходили в правильном порядке, как раз используется локальные часы Лампорта. Это механизм низкого уровня.

Алгоритмы взаимоисключения:

1. Централизованный

Реализация выполняется с использованием процесса-координатора, т е централизованно. Обычно в кач ве коорд выбир процесс который выполняется на хосте с наиб значением сетевого адреса. Если процесс желает войти в опр крит секцию он посылает проц коорд сообщение запрос с указанием названия крит секции в котор хочет войти. получив такое сообщ проц коорд проверяет не находится ли какой другой процесс в данной крит секции или может возн такая ситуация что крит секция пока не занята, но к жтой крит секции уже имеется очередь. в этом случ проц ставится в очередь и сообщ разреш не посылается, т е процесс будет блокирован до тех пор пока не получит сообщение разрешения. Таким образом решается вопрос взаимоискл. Но сеть это взаимодейст большого числа узлов и могут происходить всякие неприятные вещи. Координатор может аварийно завершиться. Очевидно, что такая ситуац разрешается только с помощью таймаутов. Нет другого средства контроля. С самими таймаутами возникают проблемы - невозможно предсказать задержки при передаче по сети. Большой таймаут - замедление работы, маленький - недостаточно времени для ожидания. Еще большая проблема - коорд аварийно завершается - вся система обеспеч центр входа в крит секции разрушается, по этому для того чтобы такая ситуация не возникала, любой процесс, обнаруживш отсутсв координатора, может инициировать новые выборы координатора для того чтобы восст работосп системы. Такой подход в терминах сетей - алгоритм забияки.
Если какой-то проц обнаруж отсутсв координ то он инициирует выборы нового координатора и посылает спец запрос в котором указывает свой номер процессам с большими номерами. Процесс получивший сообщение сравнивает свой номер, с номером в сообщении. Если его номер больше то он инициирует новые выборы (со своим номером). Процессы с собст номером меньше переходят в сост ожидания (сообщ от нового координатора). В итоге такой посылки сообщ останется один процесс с наиб сетевым номером - он будет выбран новым координатором и работосп системы будет вост. Новый коорд посылает сообщ о завершении выборов со своим сетевым адресом.

2. Распределенный

В расп алг процесс жел войти в крит секцию рассылает Н-1 сообщ-запрос всем взаимодейст процессам с указанием идент крит секции и веременем, когда у него возникла такая необходимость по своим лок часам. Процесс получивший такое сообщ-запрос анализирует его и его действия зависят от того в каком отношении к этой крит секции он сам находится. Возм 3 ситуац:

1. процесс получивш сообщ запрос не находится в данной крит секции и не собирается в нее входить. В этом сслучае он посылает процу сообщ разрешение.
2. процесс получатель находится в указ крит секции в жтом случае он не посыл сообщ разреш-е а ставит собщ запрос в очередь.
3. получатель хочет сам войти в указанную крит секцию. В этом случае он сравнивает время, которое пришло в сообщ запросе со временем в своем сообщ-запросе. Если время в его сообщ-запросе больше, чем время пришедшее в запросе от др процесса, т е его собств сообщ сформир позже, то он посылает сообщ разрешение, иначе ничего не посылает и ставит сообщ в очередь. В итоге процесс сможет войти в нужн крит секцию только получив Н-1 сообщ разрешение.

Распр менее надежна чем централизованная с выбором координатора.

3. Токен ринг

В такой сис проц выстраив в логич кольцо. в котором кажд проц знает свой номер в этом кольце и номер ближайшего к нему процесса. С каждой крит секции в такой сис связан так наз токен - это спец сообщ, которое циркулирует по кольцу. Взаимодейтсв выполняется точка-к-точке. Когда процесс получает токен и аназизирует нужно ли ему самому войти в данн крит секцию. Если нет - посылает токен дальше, если да - входит и удерживает токен при себе.

Если какой-либо из проц завершится аварийно - логич цепь будет разорвана.

===
Неделимые транзации
===

Неделимые транзакции относятся к высокоур средств взаимодействия. Транзакции (или модели транзакций).

Для того чтобы т поддержив системой необх чтобы предоставл набор функц для работы с т. Обычно это beginTransaction endTransaction abortTransaction readTransaction writeTransaction. Транзак облад некотор свойств - упорядочивоемость (гарантирует, что если две или более транзацкии выполняются параллельно, то конечный результат будет выглядеть так, как если бы все транзакции вып последовательно в некотором определенном порядке), неделимость (означает, что если т находи в проц выполнения то никакой др процесс не может увидеть ее промежуточн результаты), постоянство (после фиксации транзакции никакой сбой не может отменить результатов ее выполнения).

Существует два основных механизма реализ н т.

1. Индивидуальное рабочее пространство

Процессы задейств в транз имеют т.н. индивидуальные раб простр в которых содерж копии всех файлов и объектов, которые процессы используют (изменяют) в этой транзакции. При этом никакие изменения в исходных файлах и объектах не выполняются пока т не завершена.  все выполн в ирп. Когда т фиксируется то тогда эти изменения копируются в исходные файлы и объекты (репликация).

Крайне затратный подход.

2. Список намерений

в этом подходе модиф сами исх файлы и/или объекты, но перед изменением любого блока любого файла или внесен изм в какие-то структуры спец журналл регистрации записывается старое значение и новое. Только после успешн записи в журнал регистрации произв изменение в исходном файле или исходном объекте. Если т фиксируется, то сначала делается запись в журнал регистр но старые значения сохраняются. Если т прерывается, то инф записанн в жур рег используется для т.н. отката т е для возвр исх файлов объектов в начальное состояние. В распр сис фиксац транзакций может протребовать спец протокола взаим процессов выполн на разных машинах. при этом на отдельных машинах могут храниться свои наборы данных (индивидуальные). По этому для достиж св-ва недел т в распр системах исп спец протоколы но чаще всего используется протокол двухфазной фиксации транзакций.

Протокол - соглашение в какой послед какие действ выполняются.

Суть протокола двухф ф т: один проц выполняет функции координатора. Коор начинает транзакцию и делает запись в своем лок жур рег. После этого он посылает подчин процессам, которые выполняют эту же транзакцию сообщ "подготовиться к фиксации". Получив такое сообщение, подчин процессы проверяют готовы ли они к фиксации и делают запись в своих лок журналах. только после этого они посылают сообщ "готов к фиксации" и переходят в сост ожидания соотв сообщ от координатора. Коорд собирает все сообщения от подчин проц. Если хотябы один проц не прислал такое собщение то очевидно такая транз прерывается и должен быть сделан откат всеми процессами которые учавтсв в т в соотв с записями в лок журналах. Если коорд получил сообщ от всех подчинен проц он посылает сообщ "фиксировать" и все процессы фиксируют результаты транзакции. Такой протокол гарантир успешное заверш т всеми взаимодейств процессами.

---

Тупики
===

Взаимодейств парал проц часто приводит к тупик ситуац. Наиб полное объяснение в книге Шоу - "Логич проектрование Опер Систем". В материалах по оп системам обычно тупики упоминаются. Процессы попавшие в тупик не могут продолжать выполняться. Они блокируют друг друга. В распр сис тупиковые ситуации еще более сложные.

Проблема тупиков.
Тупики возникают при взаимодейств парал процессов. Взаим определяется как исп одних и тех же ресурсов.

Определение тупиковой ситуации:
Тупиков ситуац - это ситуация возникающая в резуль монопольного использования разделяемых ресурсов когда процесс владея ресурсом запрашивает другой ресурс занятый непосредственно или через цепочку запросовдругим процессом, который ожидает освобожд ресурса занятого первым процессом. В результате процессы блокируют друг друга таким образом что ни один из них не может продолжить свое выполнение и освободить занимаемые ими ресурсы.

Типы ресурсов и их тупики

Ресурсы с точки зрения особ их использования делятся на повторно исп и потребляемые. К повторно исп ресурсам относятся аппаратура компьютера, процессоры память устройства каналы ввода-вывода и программное обеспечение (например реентерабильные коды ОС, сис таблицы). К потребляемым - сообщения.
